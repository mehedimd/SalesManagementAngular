<div class="row">
  <div class="col-md-8 offset-md-2">
    <form [formGroup]="orderForm" (ngSubmit)="createOrder()">
      <div class="row p-3 g-2 shadow-lg my-4">
        <div class="col-md-6">
          <div class="form-group">
            <label>Order No.</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <label class="input-group-text">#</label>
              </div>
              <input
                type="text"
                class="form-control"
                formControlName="orderNo"
                readonly
              />
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="">PharmacyRoute</label>
            <select
              class="form-select"
              (change)="ChangeRoute($event)"
              [class.is-invalid]="!isRouteSelected"
              formControlName = "routeId"
            >
              <option value="">--Select Route--</option>
              @for(route of pharmacyRouteList; track route.id){
              <option [value]="route.id">
                {{ route.routeName }}
              </option>
              }
            </select>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="">Pharmacy</label>
            <select
              formControlName="pharmacyId"
              class="form-select"
              [class]="{
                'is-invalid':
                  orderForm.controls.pharmacyId.touched &&
                  orderForm.controls.pharmacyId.errors
              }"
            >
              <option value="">--Select Pharmacy--</option>
              @for(pharmacy of pharmacyList; track pharmacy.pharmacyId){
              <option [value]="pharmacy.pharmacyId">
                {{ pharmacy.pharmacyName }}
              </option>
              }
            </select>
            @if(orderForm.controls.pharmacyId.errors){
            <div class="invalid-feedback">
              @if(orderForm.controls.pharmacyId.errors['required']){
              <div>this field is required</div>
              }
            </div>
            }
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Grand Total:</label>
            <input
              type="text"
              class="form-control"
              readonly
              formControlName="grandTotal"
            />
          </div>
        </div>
        <!-- for details part OrderItem -->

        <table class="table text-center">
          <thead>
            <tr>
              <th>Product</th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Total</th>
              <th>Unit</th>
              <th>
                <button
                  type="button"
                  class="btn btn-primary"
                  (click)="addOrEditItems(null)"
                >
                  Add Product +
                </button>
              </th>
            </tr>
          </thead>
          <tbody>
            @for(item of orderService.orderItems; track item.id; let index =
            $index){
            <tr>
              <td>{{ item.productName }}</td>
              <td>{{ item.price }}</td>
              <td>{{ item.quantity }}</td>
              <td>{{ item.total }}</td>
              <td>{{ item.unitName }}</td>
              <td>
                <button
                  type="button"
                  class="btn btn-warning btn-sm"
                  (click)="addOrEditItems(index)"
                >
                  Edit
                </button>
                <button
                  type="button"
                  class="btn btn-danger btn-sm ms-2"
                  (click)="removeItems(index)"
                >
                  Delete
                </button>
              </td>
            </tr>
            }
          </tbody>
        </table>

        <div class="col-md-12">
          <button
            class="btn btn-primary"
            type="submit"
            [disabled]="orderForm.invalid"
          >
            Submit
          </button>
          <button class="btn btn-success ms-2" routerLink="/order">
            BACK TO LIST
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
